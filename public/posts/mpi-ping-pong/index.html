<!DOCTYPE html>
<html lang="en-us">

<head>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-179561110-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', 'UA-179561110-1');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1"> 
    <link rel="icon" href="/images/me.gif" type="image/gif">
    <title>MPI ping pong program using C&#43;&#43;</title>
    
    <meta name="description" content="I want to write an MPI ping pong program where two processes send a piece of data back and forth to each other."> 
    
    <meta name="author" content="map[name:Sorush Khajepor]">
    
    
    
    <link rel="stylesheet" href="https://iamsorush.com/css/style.min.css">
     

</head>

<body>
    
<div class="read-progress-container">
	<div class="progress-bar" id="myBar"></div>
</div>
<header class="header-black">
	<div class="container">

	<div>
		<div class="display-flex flex-column left-horizontal">
			<a class="scale-left-sm" href="https://iamsorush.com/">Sorush Khajepor</a>
			<span class="text-shadow-1">Numerical programming and app development</span>
		</div>
		<div class="display-flex align-center justify-start justify-md-end">	
			<a href="https://github.com/sorush-khajepor" class="mr-1 icon" aria-label="Github">
				<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="white" d="M512 0C229.25 0 0 229.25 0 512c0 226.25 146.688 418.125 350.156 485.812 25.594 4.688 34.938-11.125 34.938-24.625 0-12.188-0.469-52.562-0.719-95.312C242 908.812 211.906 817.5 211.906 817.5c-23.312-59.125-56.844-74.875-56.844-74.875-46.531-31.75 3.53-31.125 3.53-31.125 51.406 3.562 78.47 52.75 78.47 52.75 45.688 78.25 119.875 55.625 149 42.5 4.654-33 17.904-55.625 32.5-68.375C304.906 725.438 185.344 681.5 185.344 485.312c0-55.938 19.969-101.562 52.656-137.406-5.219-13-22.844-65.094 5.062-135.562 0 0 42.938-13.75 140.812 52.5 40.812-11.406 84.594-17.031 128.125-17.219 43.5 0.188 87.312 5.875 128.188 17.281 97.688-66.312 140.688-52.5 140.688-52.5 28 70.531 10.375 122.562 5.125 135.5 32.812 35.844 52.625 81.469 52.625 137.406 0 196.688-119.75 240-233.812 252.688 18.438 15.875 34.75 47 34.75 94.75 0 68.438-0.688 123.625-0.688 140.5 0 13.625 9.312 29.562 35.25 24.562C877.438 930 1024 738.125 1024 512 1024 229.25 794.75 0 512 0z"/></svg>
			</a>
			<a href="https://twitter.com/KhSorush" class="mr-1 icon" aria-label="Twitter">
				<svg id="Logo_FIXED" data-name="Logo â€” FIXED" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400"><defs><style>.cls-1{fill:none;}.cls-2{fill:#1da1f2;}</style></defs><title>Twitter_Logo_Blue</title><rect class="cls-1" width="400" height="400"/><path class="cls-2" d="M153.62,301.59c94.34,0,145.94-78.16,145.94-145.94,0-2.22,0-4.43-.15-6.63A104.36,104.36,0,0,0,325,122.47a102.38,102.38,0,0,1-29.46,8.07,51.47,51.47,0,0,0,22.55-28.37,102.79,102.79,0,0,1-32.57,12.45,51.34,51.34,0,0,0-87.41,46.78A145.62,145.62,0,0,1,92.4,107.81a51.33,51.33,0,0,0,15.88,68.47A50.91,50.91,0,0,1,85,169.86c0,.21,0,.43,0,.65a51.31,51.31,0,0,0,41.15,50.28,51.21,51.21,0,0,1-23.16.88,51.35,51.35,0,0,0,47.92,35.62,102.92,102.92,0,0,1-63.7,22A104.41,104.41,0,0,1,75,278.55a145.21,145.21,0,0,0,78.62,23"/></svg>
			</a>
			<a href="https://scholar.google.co.uk/citations?user=16Y7-NsAAAAJ&hl=en" class="mr-1 icon" aria-label="Google Scholar">
				<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g data-name="Layer 2" id="Layer_2"><polygon fill="white" points="0.54 9 5 10.98 7 11.87 12 14.09 17 11.87 19 10.98 20 10.54 20 16 22 16 22 9.65 23.46 9 12 3.91 0.54 9"/><path fill="white" d="M18.45,18.89l.55-.27V13.17l-7,3.11L5,13.17v5.45l.55.27a14.45,14.45,0,0,0,12.9,0Z"/></g></svg>
			</a>
			<a href="https://stackoverflow.com/users/2543510/sorush" class="mr-1 icon" aria-label="Stackoverflow">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 120"><style>.st0{fill:#bcbbbb}.st1{fill:#f48023}</style><path class="st0" d="M84.4 93.8V70.6h7.7v30.9H22.6V70.6h7.7v23.2z"/><path class="st1" d="M38.8 68.4l37.8 7.9 1.6-7.6-37.8-7.9-1.6 7.6zm5-18l35 16.3 3.2-7-35-16.4-3.2 7.1zm9.7-17.2l29.7 24.7 4.9-5.9-29.7-24.7-4.9 5.9zm19.2-18.3l-6.2 4.6 23 31 6.2-4.6-23-31zM38 86h38.6v-7.7H38V86z"/></svg>
			</a>
			<a href="https://www.linkedin.com/in/sorushkh/" class="mr-1 icon" aria-label="Linkedin">
				<svg enable-background="new 0 0 32 32" height="32px" id="Layer_1" version="1.0" viewBox="0 0 32 32" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M32,30c0,1.104-0.896,2-2,2H2c-1.104,0-2-0.896-2-2V2c0-1.104,0.896-2,2-2h28c1.104,0,2,0.896,2,2V30z" fill="#007BB5"/><g><rect fill="#FFFFFF" height="14" width="4" x="7" y="11"/><path d="M20.499,11c-2.791,0-3.271,1.018-3.499,2v-2h-4v14h4v-8c0-1.297,0.703-2,2-2c1.266,0,2,0.688,2,2v8h4v-7    C25,14,24.479,11,20.499,11z" fill="#FFFFFF"/><circle cx="9" cy="8" fill="#FFFFFF" r="2"/></g></g><g/><g/><g/><g/><g/><g/></svg>
			</a>
		</div>
	
	
	
    </div>
	</div>
</header>

<main>
	<article>
		<h1>MPI ping pong program using C&#43;&#43;</h1>
		<time>14 Nov 2020</time>
	</article>
	





    	



    










<style>
    .post__hero{
        background-image: url('https://iamsorush.com/images/pingpong_hu3d03a01dcc18bc5be0e67db3d8d209a6_97529_430x250_fill_q65_box_center.jpg');
        height: 250px;
    }
    @media (min-width: 430px) {
        .post__hero{
        background-image: url('https://iamsorush.com/images/pingpong_hu3d03a01dcc18bc5be0e67db3d8d209a6_97529_768x400_fill_q65_box_center.jpg');
        height: 400px;
    }
    @media (min-width: 768px) {
        .post__hero{
        background-image: url('https://iamsorush.com/images/pingpong_hu3d03a01dcc18bc5be0e67db3d8d209a6_97529_1024x400_fill_q65_box_center.jpg');
        height: 400px;
    }
    }
    @media (min-width: 1024px) {
        .post__hero{
        background-image: url('https://iamsorush.com/images/pingpong_hu3d03a01dcc18bc5be0e67db3d8d209a6_97529_1280x400_fill_q65_box_center.jpg');
        height: 400px;
    }
    }
        
</style>
<div class="single-image post__hero"></div>
	<div class="article-nav" id="article-nav-id">
		<article class="overlay-top">
			<h2 id="goal">Goal</h2>
<p>I want to write an MPI ping pong program where two processes send a piece of data back and forth
to each other. This is a good example to measure the latency and bandwidth of a cluster machine. Since, currently, the MPI for C is developing stronger than C++ (see <a href="#references">References</a>), I am wrapping MPI-C commands in C++ classes here.</p>
<h2 id="the-ball">The ball</h2>
<p>If we imagine the data transfer between two nodes is like a ping-pong game, the data is the ball.
The ball can be an array of MPI types. Here for simplicity, is the integer:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Ball</span>
{
    Ball(<span style="color:#66d9ef">int</span> size){
        Data <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span>[size];
        Data[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        Size <span style="color:#f92672">=</span> size;
    }
    <span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> Data;
    <span style="color:#66d9ef">int</span> Size;
};
</code></pre></div><p>In this example, I ignore what is in <code>Data</code> array except <em>0-th</em> element which counts the number of back-and-forths of the ball.</p>
<h2 id="iplayer">IPlayer</h2>
<p>As I am still thinking in the world of ping pong, I call each process a player. We have different players, rank 0 and 1 which play the game and the other ranks which are idle. So to avoid nested if-conditions, I created <code>IPlayer</code> interface:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">IPlayer</span>
{
    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Play</span>()<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
};
</code></pre></div><h2 id="idle">Idle</h2>
<p><code>IPlayer</code> is adopted by the <code>Idle</code> class which does nothing</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Idle</span><span style="color:#f92672">:</span> IPlayer
{
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Play</span>() <span style="color:#66d9ef">override</span>{};
};
</code></pre></div><h2 id="player">Player</h2>
<p>The players of the game adopt the same interface. The constructor of <code>Player</code>  needs to set some private members like who is the starter of the game. If the player&rsquo;s rank is 0 its target is 1 and vice versa.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Player</span><span style="color:#f92672">:</span> IPlayer
{
    Player(Ball<span style="color:#f92672">&amp;</span> _ball, <span style="color:#66d9ef">bool</span> _iAmGameStarter)<span style="color:#f92672">:</span> 
        ball(_ball), iAmGameStarter(_iAmGameStarter){
        
        MPI_Comm_rank(MPI_COMM_WORLD, <span style="color:#f92672">&amp;</span>rank);
        MPI_Comm_size(MPI_COMM_WORLD, <span style="color:#f92672">&amp;</span>size);

        <span style="color:#75715e">// At least 2 processors needed
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (size<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">2</span>){<span style="color:#66d9ef">throw</span>;}

        target <span style="color:#f92672">=</span> (rank <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>;
    };
    <span style="color:#75715e">// ... rest of the code
</span><span style="color:#75715e"></span>}
</code></pre></div><p>A player sends the ball and waits to receive it back. I used <code>MPI_Send</code> to send the ball in a blocking way. It will receive the ball using <code>MPI_Recv</code> which blocks the process until the ball buffer is reusable. Both block the buffer, the ball, to make sure there is not a race condition to read and write there. For more information, read more on <a href="https://iamsorush.com/posts/mpi-race-condition/">the MPI race condition here</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">SendBall</span>(){
        MPI_Send( ball.Data , ball.Size , MPI_INT , target , <span style="color:#ae81ff">0</span> , MPI_COMM_WORLD);
    }
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RecvBall</span>(){
        MPI_Recv( ball.Data, ball.Size , MPI_INT, target, <span style="color:#ae81ff">0</span> , MPI_COMM_WORLD, <span style="color:#f92672">&amp;</span>stat);
    }
</code></pre></div><p>I have to override <code>Play</code> of the interface. It basically calls <code>SendBall()</code> and <code>RecvBall()</code> in the order depending on who&rsquo;s started the game. After each player receives the ball, they increment <code>Data[0]</code> by one, firstly to count communications and secondly to show the program works fine.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Play</span>() <span style="color:#66d9ef">override</span>{
        <span style="color:#66d9ef">if</span> (iAmGameStarter) SendBall();
        RecvBall();
        ball.Data[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">++</span>;
        cout<span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Rank :&#34;</span> <span style="color:#f92672">&lt;&lt;</span> rank <span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">&#34; has the ball, No of throws: &#34;</span>
            <span style="color:#f92672">&lt;&lt;</span> ball.Data[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">&lt;&lt;</span>endl;
        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>iAmGameStarter) SendBall();
    }
</code></pre></div><h2 id="code">Code</h2>
<p>The whole code is here.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;mpi.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;

<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Ball</span>
{
    Ball(<span style="color:#66d9ef">int</span> size){
        Data <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span>[size];
        Data[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        Size <span style="color:#f92672">=</span> size;
    }
    <span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> Data;
    <span style="color:#66d9ef">int</span> Size;
};

<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">IPlayer</span>
{
    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Play</span>()<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
};

<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Idle</span><span style="color:#f92672">:</span> IPlayer
{
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Play</span>() <span style="color:#66d9ef">override</span>{};
};

<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Player</span><span style="color:#f92672">:</span> IPlayer
{
    Player(Ball<span style="color:#f92672">&amp;</span> _ball, <span style="color:#66d9ef">bool</span> _iAmGameStarter)<span style="color:#f92672">:</span> 
        ball(_ball), iAmGameStarter(_iAmGameStarter){
        
        MPI_Comm_rank(MPI_COMM_WORLD, <span style="color:#f92672">&amp;</span>rank);
        MPI_Comm_size(MPI_COMM_WORLD, <span style="color:#f92672">&amp;</span>size);

        <span style="color:#75715e">// At least 2 processors needed
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (size<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">2</span>){<span style="color:#66d9ef">throw</span>;}

        target <span style="color:#f92672">=</span> (rank <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>;
    };
    
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">SendBall</span>(){
        MPI_Send( ball.Data , ball.Size , MPI_INT , target , <span style="color:#ae81ff">0</span> , MPI_COMM_WORLD);
    }
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RecvBall</span>(){
        MPI_Recv( ball.Data, ball.Size , MPI_INT, target, <span style="color:#ae81ff">0</span> , MPI_COMM_WORLD, <span style="color:#f92672">&amp;</span>stat);
    }
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Play</span>() <span style="color:#66d9ef">override</span>{
        <span style="color:#66d9ef">if</span> (iAmGameStarter) SendBall();
        RecvBall();
        ball.Data[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">++</span>;
        cout<span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Rank :&#34;</span> <span style="color:#f92672">&lt;&lt;</span> rank <span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">&#34; has the ball, No of throws: &#34;</span><span style="color:#f92672">&lt;&lt;</span>ball.Data[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">&lt;&lt;</span>endl;
        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>iAmGameStarter) SendBall();
    }
    
<span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
    Ball<span style="color:#f92672">&amp;</span> ball;
    <span style="color:#66d9ef">int</span> rank;
    <span style="color:#66d9ef">int</span> size;
    <span style="color:#66d9ef">int</span> target;
    <span style="color:#66d9ef">bool</span> iAmGameStarter;
    MPI_Request req;
    MPI_Status stat;
};


<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {

    MPI_Init(NULL, NULL);

    <span style="color:#66d9ef">int</span> rank;
    MPI_Comm_rank(MPI_COMM_WORLD, <span style="color:#f92672">&amp;</span>rank);

    <span style="color:#75715e">// Customize here
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> ballSize <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000000</span>;
    <span style="color:#66d9ef">int</span> warmupIterations <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> mainIterations <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;

    Ball ball(ballSize);

    IPlayer<span style="color:#f92672">*</span> player;

    <span style="color:#75715e">// Only rank 0 and 1 play the game
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (rank<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>){
        <span style="color:#75715e">// Rank 0 starts the game
</span><span style="color:#75715e"></span>        player <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Player(ball, true);
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (rank<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>)
    {
        player <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Player(ball, false);
    } <span style="color:#66d9ef">else</span>
    {
        player <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Idle();
    }
    
    <span style="color:#75715e">// Warm up players before the game
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (size_t i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> warmupIterations; i<span style="color:#f92672">++</span>)
    {
        player<span style="color:#f92672">-&gt;</span>Play();
    }

    <span style="color:#66d9ef">double</span> start <span style="color:#f92672">=</span> MPI_Wtime();
    <span style="color:#75715e">// Main loop to be monitored
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (size_t i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> mainIterations; i<span style="color:#f92672">++</span>)
    {
        player<span style="color:#f92672">-&gt;</span>Play();
    }
    <span style="color:#66d9ef">double</span> end <span style="color:#f92672">=</span> MPI_Wtime();

    <span style="color:#66d9ef">auto</span> elapsedTime <span style="color:#f92672">=</span> end<span style="color:#f92672">-</span>start;
    <span style="color:#75715e">// each iteration has 2 transfers: send and receive
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> transferTime <span style="color:#f92672">=</span> elapsedTime<span style="color:#f92672">/</span>(mainIterations <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>);
    <span style="color:#66d9ef">auto</span> ballSizeInGigaByte <span style="color:#f92672">=</span> ballSize <span style="color:#f92672">*</span> <span style="color:#ae81ff">4.0</span> <span style="color:#75715e">/* byte */</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000000000</span>;

    <span style="color:#66d9ef">if</span> (rank<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) 
    {
        cout<span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Ball size (GB): &#34;</span><span style="color:#f92672">&lt;&lt;</span> ballSizeInGigaByte<span style="color:#f92672">&lt;&lt;</span>endl;
        cout<span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Transfer time (Sec): &#34;</span><span style="color:#f92672">&lt;&lt;</span> transferTime <span style="color:#f92672">&lt;&lt;</span>endl;
        cout<span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Bandwidth (GB/s): &#34;</span> <span style="color:#f92672">&lt;&lt;</span> ballSizeInGigaByte<span style="color:#f92672">/</span>transferTime <span style="color:#f92672">&lt;&lt;</span>endl;
    }
    
    MPI_Finalize();
}
</code></pre></div><h2 id="validation">Validation</h2>
<p>The first run is only 3 iterations to see how the ball moves back and forth. In all tests, only 2 processes were utilized.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">BallSize <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>,<span style="color:#ae81ff">000</span>
main iterations <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
warm up iterations <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

Rank :<span style="color:#ae81ff">1</span> has the ball, No of <span style="color:#66d9ef">throws</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
Rank :<span style="color:#ae81ff">0</span> has the ball, No of <span style="color:#66d9ef">throws</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>
Rank :<span style="color:#ae81ff">1</span> has the ball, No of <span style="color:#66d9ef">throws</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>
Rank :<span style="color:#ae81ff">0</span> has the ball, No of <span style="color:#66d9ef">throws</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span>
Rank :<span style="color:#ae81ff">1</span> has the ball, No of <span style="color:#66d9ef">throws</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5</span>
Rank :<span style="color:#ae81ff">0</span> has the ball, No of <span style="color:#66d9ef">throws</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">6</span>
</code></pre></div><h2 id="bandwidth">Bandwidth</h2>
<p>The second run is to measure the bandwidth:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">BallSize <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>,<span style="color:#ae81ff">000</span>
warm up iterations <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
iterations <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">000</span>

Ball size (GB)<span style="color:#f92672">:</span> <span style="color:#ae81ff">0.004</span>
Transfer time (Sec)<span style="color:#f92672">:</span> <span style="color:#ae81ff">0.000531798</span>
Bandwidth (GB<span style="color:#f92672">/</span>s)<span style="color:#f92672">:</span> <span style="color:#ae81ff">7.52166</span>
</code></pre></div><h2 id="references">References</h2>
<p>I got ideas and codes from the below website(s)</p>
<p><a href="https://www.open-mpi.org/doc/v4.0/">OpenMPI</a>
<a href="https://www.archer.ac.uk/training/course-material/2017/08/mpi-exeter/exercises/MPP-exercises.pdf">EPCC MPI Exercise</a>
<a href="https://github.com/olcf-tutorials/MPI_ping_pong">OLCF-tutorials</a>
<a href="https://www.boost.org/doc/libs/1_74_0/doc/html/mpi.html#mpi.introduction">Boost MPI</a>
<a href="https://github.com/mpi-forum/mpi-forum-historic/issues/150">MPI Deprecated the C++ bindings</a></p>

			
			<script>
				window.onscroll = function () {
					myFunction();
				};
				function myFunction() {
					var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
					var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
					var scrolled = (winScroll / height) * 100;
					document.getElementById("myBar").style.width = scrolled + "%";
				}
			</script>
			<hr style="width:5%;text-align:left;margin-left:0;margin-top: 3em;border-top: 3px solid rgb(87, 86, 86);
			border-radius: 5px;">
			


  <h3>Related Tags</h3>
    <div id="tags">
        
        <span><a href="/tags/mpi">MPI</a> </span>
        
        <span><a href="/tags/c&#43;&#43;">C&#43;&#43;</a> </span>
        
    </div>



			<hr style="width:5%;text-align:left;margin-left:0;margin-top: 3em;border-top: 3px solid rgb(87, 86, 86);
			border-radius: 5px;">
			
<div>
	<h3>Latest Posts</h3>
</div>
<div>
	<ul>
		
		<li><a href="/posts/mpi-race-condition/">MPI race condition</a></li>
		
		<li><a href="/posts/mpi-ping-pong/">MPI ping pong program using C&#43;&#43;</a></li>
		
		<li><a href="/posts/linux-connection-packages/">Handy free Windows packages to connect to a remote Linux server</a></li>
		
		<li><a href="/posts/mpi-send-types/">The difference between modes of MPI send</a></li>
		
		<li><a href="/posts/all-about-template/">C&#43;&#43; template crash course</a></li>
		
	</ul>
</div>
	
		</article>
		<nav class="hide-on-mobile section-nav">
			<h3 class="ml-1">Table of contents</h3>
			<nav id="TableOfContents">
  <ul>
    <li><a href="#goal">Goal</a></li>
    <li><a href="#the-ball">The ball</a></li>
    <li><a href="#iplayer">IPlayer</a></li>
    <li><a href="#idle">Idle</a></li>
    <li><a href="#player">Player</a></li>
    <li><a href="#code">Code</a></li>
    <li><a href="#validation">Validation</a></li>
    <li><a href="#bandwidth">Bandwidth</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
		</nav>		
	</div>
</main>
<script>
	window.addEventListener('DOMContentLoaded', () => {
		const observerForTableOfContentActiveState = new IntersectionObserver(entries => {
			entries.forEach(entry => {
				const id = entry.target.getAttribute('id');

				if (entry.intersectionRatio > 0) {					
					clearActiveStatesInTableOfContents();				
					document.querySelector(`nav li a[href="#${id}"]`).parentElement.classList.add('active');
				}
			});
		});		
		document.querySelectorAll('h1[id],h2[id],h3[id],h4[id]').forEach((section) => {
			observerForTableOfContentActiveState.observe(section);
		});

	});

	function clearActiveStatesInTableOfContents() {
		document.querySelectorAll('nav li').forEach((section) => {
			section.classList.remove('active');
		});
	}
</script>
 <footer>
    <div class="container">
	<div class="my-2">
	<form name="Subscription" method="POST" data-netlify="true" netlify-honeypot="ahani" action="/pages/sub-success">
		<p class="nedia">
		  <label> Name <input name="ahani" /></label>
		</p>
		<p><label for="emailinput">Subscribe so I notify you of new posts</label></p>
		<p class="display-flex">
		  <input id="emailinput" style="width: 18em;" class="mr-1" type="email" name="email" placeholder=" Email"/>
		  <button type="submit">Subscribe</button>
		</p>
	</form>
</div>
<div class="my-1 display-flex justify-start justify-md-end align-center">
	<p>Copyright &copy; 2020 <a href="https://iamsorush.com/">Sorush Khajepor</a></p>
</div>
</div>
</footer>



  
</body>

</html>